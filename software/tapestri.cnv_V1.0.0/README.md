# Overview
`tapestri.cnv` is an R package for CNV analysis of data generated by the Tapestri platform

# Installation

Install `devtools` first and then install the other packages. `devtools` will attempt to automatically install prerequisites for these packages.
NOTE: Install each package independently, as install script may prompt to update previously downloaded packages.

```r
install.packages(c("devtools", "hdf5r"))
devtools::install_github("mojaveazure/loomR")
devtools::install_github("jokergoo/ComplexHeatmap")

if (!requireNamespace("BiocManager", quietly = TRUE))
    install.packages("BiocManager")
BiocManager::install("karyoploteR")
BiocManager::install("annotatr")
BiocManager::install("TxDb.Hsapiens.UCSC.hg19.knownGene")
BiocManager::install("org.Hs.eg.db")
```

Download `tapestri.cnv` R package & then install as a local package
```r
devtools::install_local(path = "tapestri.cnv_0.1.0.tar.gz", repos='http://cran.us.r-project.org', clean = TRUE)
```


# Usage

Sample commands below demonstrate how to generate a heat map for Loss of Heterozygosity (LOH) in an input sample. Review the vignette included in this package to learn about available commands and their usage.

``` r
library(tapestri.cnv)

# Read barcodes
tube_0_barcode_file <- "mysample.rg0.barcode.cell.distribution.tsv"
tube_1_barcode_file <- "mysample.rg1.barcode.cell.distribution.tsv"
vcf_header_file <- "vcf_header.txt"

# Read barcodes
barcodes <- read_barcodes(c(tube_0_barcode_file, tube_1_barcode_file), vcf_header_file)
normalized_barcodes <- normalize_barcodes(barcodes)

# Read LOOM file
loom_file <- mysample.loom
loom <- connect_to_loom(loom_file)

# Extract genotypes
# Filter by genotype quality matrix
genotypes <- extract_genotypes(loom, normalized_barcodes)

# Cluster barcodes
max_cluster <- cluster_barcodes(normalized_barcodes, 'kmeans')

# Plot loh heatmap
snv_heatmap(genotypes, max_cluster=max_cluster)

```

# Getting help
If you have any questions or need more information about this R package or the methods it implements, please contact Mission Bio at support@missionbio.com

# License
AGPL-3
